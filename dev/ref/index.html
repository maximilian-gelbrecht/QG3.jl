<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · QG3</title><meta name="title" content="Reference · QG3"/><meta property="og:title" content="Reference · QG3"/><meta property="twitter:title" content="Reference · QG3"/><meta name="description" content="Documentation for QG3."/><meta property="og:description" content="Documentation for QG3."/><meta property="twitter:description" content="Documentation for QG3."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="QG3 logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">QG3</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/maximilian-gelbrecht/QG3.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/main/docs/src/ref.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.AbstractGridType" href="#QG3.AbstractGridType"><code>QG3.AbstractGridType</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractGridType{T, onGPU}</code></pre><p>Abstract type for grids. The grids save information about the transform from the spatial to spectral grid, e.g. pre-computed Legendre Polynomials</p><p>Required fields: </p><ul><li><code>GtoSH</code></li><li><code>SHtoG</code></li><li><code>dμ</code></li><li><code>dλ</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/QG3.jl#L42-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.AbstractSHTransform" href="#QG3.AbstractSHTransform"><code>QG3.AbstractSHTransform</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractSHTransform{onGPU}</code></pre><p>Required fields for all subtypes: </p><ul><li>outputsize</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L3-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.AbstractμDerivative" href="#QG3.AbstractμDerivative"><code>QG3.AbstractμDerivative</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>abstract type AbstractμDerivative{onGPU} &lt; AbstractDerivative{onGPU} </p><p>Required fields: </p><ul><li><code>msinθ</code>: To change between μ and latitude derivative (-sin(colats))</li><li><code>msinθ_3d</code>: To change between μ and latitude derivative (-sin(colats))</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L16-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.ContinousTimeForcing" href="#QG3.ContinousTimeForcing"><code>QG3.ContinousTimeForcing</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TimeForcing</code></pre><p>Time-dependent Forcing</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/forcing.jl#L57-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Derivative_dλ" href="#QG3.Derivative_dλ"><code>QG3.Derivative_dλ</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Derivative_dλ(p::QG3ModelParameters{T}; N_batch::Int=0)</code></pre><p>Pre-computes Derivatives by longitude. Uses the SH relation, is therefore independ from the grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L27-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.GaussianGrid" href="#QG3.GaussianGrid"><code>QG3.GaussianGrid</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs"> GaussianGrid{T, onGPU} &lt;: AbstractGridType{T, onGPU}</code></pre><p>Struct for the transforms and derivates of a Gaussian Grid</p><p><strong>Fields:</strong></p><ul><li><code>GtoSH::GaussianGridtoSHTransform</code></li><li><code>SHtoG::GaussianSHtoGridTransform</code></li><li><code>dμ::GaussianGrid_dμ</code></li><li><code>dλ::Derivative_dλ</code></li><li><code>Δ::Laplacian</code></li><li><code>∇8::Hyperdiffusion</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L114-L127">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.GaussianGrid_dμ" href="#QG3.GaussianGrid_dμ"><code>QG3.GaussianGrid_dμ</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">GaussianGrid_dμ(p::QG3ModelParameters{T}, N_level::Int=3; N_batch::Int=0)</code></pre><p>Pre-computes Pseudo-spectral approach to computing derivatives with repsect to μ = sin(lats). Derivatives are called with following the naming scheme: &quot;Domain1Input&quot;to&quot;Domain2Output&quot;_d&quot;derivativeby&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L134-L139">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.GaussianGridtoSHTransform" href="#QG3.GaussianGridtoSHTransform"><code>QG3.GaussianGridtoSHTransform</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">GaussianGridtoSHTransform(p::QG3ModelParameters{T}, N_level::Int=3; N_batch::Int=0)</code></pre><p>Returns transform struct, that can be used with <code>transform_SH</code>. Transforms Gaussian Grid data to real spherical harmonics coefficients that follow the coefficient logic explained in the main documenation.</p><p><strong>Additional input arguments:</strong></p><ul><li><code>N_level</code>: defines the transform for <code>N_level</code> horizontal levels. Has to be equal to three for the QG3 model itself, but might be different for other applications. </li><li><code>N_batch</code>: defines the transforms with an additional batch dimension for ML tasks, if <code>N_batch==0</code> this is omitted</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L121-L130">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Hyperdiffusion" href="#QG3.Hyperdiffusion"><code>QG3.Hyperdiffusion</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Hyperdiffusion(p::QG3ModelParameters{T}; scale::T=T(1)) where T</code></pre><p>Initializes the Hyperdiffusion / horizonatal diffusion operator. </p><p>Apply it via the (@ref)[<code>∇8</code>] functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L295-L301">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.KineticEnergyCallback" href="#QG3.KineticEnergyCallback"><code>QG3.KineticEnergyCallback</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">KineticEnergyCallback{T}(m::QG3Model)</code></pre><p>Initializes a callback to compute the kinetic energy. Can be called with <code>(u, t, integrator)</code> and therefore used with a <code>SavingCallback</code>.</p><p>To initialize a <code>SavingCallback</code> you can e.g. do</p><pre><code class="language-julia hljs">vals = SavedValues(eltype(m), Vector{eltype(m)})
sol = solve(prob; cb=SavingCallback(KineticEnergyCallback(m), vals))
vals.saveval </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L168-L180">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Laplacian" href="#QG3.Laplacian"><code>QG3.Laplacian</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Laplacian(p::QG3ModelParameters{T}; init_inverse=false, R::T=T(1), N_batch::Int=0, kwargs...) where T</code></pre><p>Initializes the <code>Laplacian</code> in spherical harmonics and if <code>init_inverse==true</code> also its inverse</p><p>Apply the Laplacian with the functions (@ref)[<code>Δ</code>] and (@ref)[<code>Δ⁻¹</code>]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L228-L234">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3Model" href="#QG3.QG3Model"><code>QG3.QG3Model</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3Model{T}</code></pre><p>Holds all parameter and grid information, plus additional pre-computed fields that save computation time during model integration. All these parameter are seen as constants and not trainable. It should be computed on CPU, if you are on GPU use <code>CUDA.@allowscalar QG3Model(...)</code>.</p><p><strong>Fields</strong></p><ul><li><code>p::QG3ModelParameters{T}</code> Parameters of the model</li><li><code>g::AbstractGridType{T}</code> Grid type with pre-computed plans or Legendre polynomals and co.</li><li><code>k::AbstractArray{T,2}</code> Array, drag coefficient pre-computed from orography and land-sea mask</li><li><code>TRcoeffs::AbstractArray{T,3}</code> Array of Temperature relaxation coefficients (2d version)</li><li><code>TR_matrix</code> Matrix for temperature relaxation (3d version)</li><li><code>cosϕ::AbstractArray{T,2}</code> cos(latitude) pre computed</li><li><code>acosϕi::AbstractArray{T,2}</code> inverse of a*cos(latitude) pre computed</li><li><code>Tψq</code> matrix used for transforming stream function to voriticy   q = Tψq * ψ + F</li><li><code>Tqψ</code>`inverse of Tψq   ψ = Tqψ*(q - F)</li><li><code>f</code> modified coriolis vector used in transforming stream function to vorticity</li><li><code>f_J3</code> coriolis contribution to Jacobian at 850hPa</li><li><code>∂k∂ϕ</code> derivates of drag coefficients, pre computed for Ekman dissipation</li><li><code>∂k∂μ</code></li><li><code>∂k∂λ</code> includes 1/cos^2ϕ (for Ekman dissipiation computation)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L172-L194">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3Model-Tuple{QG3ModelParameters}" href="#QG3.QG3Model-Tuple{QG3ModelParameters}"><code>QG3.QG3Model</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3Model(p::QG3ModelParameters; N_level::Integer=3, kwargs...)</code></pre><p>Routine that pre computes the QG3 Model and returns a QG3Model struct with all precomputed fields except for the forcing.</p><p>The pre-computation is always done on CPU due to scalar indexing being used, if a GPU is avaible the final result is then transferred to the GPU.</p><p>If <code>N_level</code>` is set to values other than three, the pre-computations for the transforms and derivatives are computed with N_level levels, but the full model will not be working! This is just for accessing the transforms and derivatives</p><p>All <span>$kwargs$</span> are forwarded to <code>grid</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L212-L222">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3ModelParameters" href="#QG3.QG3ModelParameters"><code>QG3.QG3ModelParameters</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3ModelParameters{T}</code></pre><p>Saves all the parameters of the model, also the units/normalization. </p><p><strong>Fields</strong></p><ul><li><code>L::Int</code>: number of SH number l, note that 0,...,l<em>max, so that L is l</em>max + 1</li><li><code>M::Int</code>: # maximum number M values, M==2<em>L - 1 / 2</em>l_max + 1</li><li><code>N_lats::Int</code></li><li><code>N_lons::Int</code></li><li><code>lats::AbstractArray{T,1}</code></li><li><code>θ::AbstractArray{T,1}</code> colatitudes = θ</li><li><code>μ::AbstractArray{T,1}</code> sin(lats) == cos(colats)</li><li><code>LS::AbstractArray{T,2}</code> Land see mask, on the same grid as lats and lons</li><li><code>h::AbstractArray{T,2}</code>` orography, array on the same grid as lats and lons</li><li><code>R1i::T</code> square inverse of Rossby radius 1 200-500hPa, default 1/(700km)^2</li><li><code>R2i::T</code> square inverse of Rossby radius 2 500-800hPa, default 1/(450km)^2</li><li><code>H0::T</code> scaling parameter for topography, default 9000m</li><li><code>τRi::T</code> inverse of radiative time scale, default 1/(25d)</li><li><code>τEi::T</code> inverse of drag time scale, default 1/(3d)</li><li><code>cH::T</code> horizonatal diffusion coefficient</li><li><code>α1::T</code> drag coefficient 1, default 0.5</li><li><code>α2::T</code> drag coefficient 2, default 0.5</li><li><code>gridtype::String</code> either &#39;gaussian&#39; or &#39;regular&#39;, &#39;gaussian&#39; leads to all transform being done by somewhat naively implemented transforms, &#39;regular&#39; uses FastTransforms.jl</li><li><code>time_unit::T</code> unit so that t [normalized] = t [d] / time_unit, default = 1 / 4π</li><li><code>distance_unit::T</code>, default Earth&#39;s radius, so that s [normalized] = s [m] / distance_unit, default = 6.371e6</li><li><code>ψ_unit::T</code>, derived from time<em>unit and distance</em>unit, so that ψ [normalized] = ψ [m^2/s] / ψ_unit</li><li><code>q_unit::T</code>, derived from time<em>unit and distance</em>unit</li></ul><p><strong>Other constructors</strong></p><pre><code class="nohighlight hljs">QG3ModelParameters(L::Int, lats::AbstractArray{T,1}, lons::AbstractArray{T,1}, LS::AbstractArray{T,2}, h::AbstractArray{T,2}, R1i::T, R2i::T, H0::T, τRi::T, τEi::T, τHi::T, α1::T, α2::T, a::T, gridtype::String, time_unit::T, distance_unit::T)</code></pre><p>Default arguments for most parameters, so that</p><pre><code class="nohighlight hljs">QG3ModelParameters(L::Int, lats::AbstractArray{T,1}, lons::AbstractArray{T,1}, LS::AbstractArray{T,2}, h::AbstractArray{T,2})</code></pre><p>works as well.</p><p><strong>Normalization/units of the model</strong></p><p>The model is normalized in (natural) units of the system. </p><ul><li>Distance: The Earth&#39;s radius is set to <code>1</code> (and thus all units containing distance are scaled with the actual radius of the Earth)</li><li>Vorticity: Earth&#39;s angular speed is approximately 2π/d, here Earth&#39;s angular speed is set 2Ω = 1, so that the planetery vorticity component of the Jacobian is just ∂ψ/∂λ. Therefore: Ω = 1/2, it follows 2*2π [1/d] = 1 [Ω<em>normalized], therefore Ω</em>normalized = 4π/d. </li><li>Time: From the vorticity unit, follows the time unit is [d/4π] = [d<em>normalized]. Hence, time in days must be devided by 4π to get the natural time unit, or [d</em>normalized] = 4π [d]</li><li>both ψ and q thus need to expressed in these units too, this can be done using the <code>ψ_unit</code> and <code>q_unit</code>    </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L5-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGaussianGridTransform" href="#QG3.SHtoGaussianGridTransform"><code>QG3.SHtoGaussianGridTransform</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoGaussianGridTransform(p::QG3ModelParameters{T}, N_level::Int=3; N_batch::Int=0)</code></pre><p>Returns transform struct, that can be used with <code>transform_grid</code>. Transforms real spherical harmonics coefficients to Gaussian grid data, follows the coefficient logic explained in the main documenation.</p><p><strong>Additional input arguments:</strong></p><ul><li><code>N_level</code>: defines the transform for <code>N_level</code> horizontal levels. Has to be equal to three for the QG3 model itself, but might be different for other applications. </li><li><code>N_batch</code>: defines the transforms with an additional batch dimension for ML tasks, if <code>N_batch==0</code> this is omitted</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L229-L238">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.D-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.D-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.D</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">D(ψ::AbstractArray{T,3}, q::AbstractArray{T,3}, m::QG3Model{T})</code></pre><p>Computes the dissipiation of all levels, 850hPa has additional Ekman dissipation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L34-L38">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.EK-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.EK-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.EK</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">EK(ψ::AbstractArray{T,2}, m::QG3Model{T})</code></pre><p>Computes the Ekman dissipation with: </p><p>EK = ∇(k∇ψ) = (∇k ∇ψ) + k Δψ  EK = 1/a^2cos^2ϕ ∂k/∂λ ∂ψ/∂λ + 1/a^2 ∂k/∂ϕ ∂ψ/∂ϕ + k Δψ   (a==1)</p><p>m.∂k∂λ  includes 1/cos^2ϕ</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L102-L111">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.H-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, Int64, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.H-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, Int64, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.H</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">H(qprime::AbstractArray{T,3}, i::Int, m::QG3Model{T})</code></pre><p>Computes the Horizontal diffusion at level <code>i</code>, q&#39; is anomolous pv (without coriolis) 2D Fields m.cH∇8 = m.p.cH * m.∇8</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L127-L131">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.H-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.H-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.H</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">H(qprime::AbstractArray{T,3}, m::QG3Model{T})</code></pre><p>Computes the horizontal diffusion, q&#39; is anomolous pv (without coriolis) 3D Fields</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L20-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.J-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.J-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.J</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">J(ψ::AbstractArray{T,3}, q::AbstractArray{T,3}, m::QG3Model{T})</code></pre><p>Computes the Jacobian for the QG3 model in 3D Field formulation (e.g. for GPU). Takes as an imput the streamfunction ψ and the potential vorticity q&#39; without the coriolis contribution. Adds the contribution of the Coriolis force and orography at the 850hPa level that is prescribed in the MM QG3 Model. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.J-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractMatrix{T}, QG3.AbstractGridType{T}}} where T&lt;:Number" href="#QG3.J-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractMatrix{T}, QG3.AbstractGridType{T}}} where T&lt;:Number"><code>QG3.J</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">J(ψ::AbstractArray{T,2}, q::AbstractArray{T,2}, g::AbstractGridType{T})</code></pre><p>Compute the Jacobian determinant from ψ and q in μ,λ coordinates, J = ∂ψ/∂x ∂q/∂y - ∂ψ/∂y ∂q/∂x = 1/a^2cosϕ ( - ∂ψ/∂λ ∂q/∂ϕ + ∂ψ/∂ϕ ∂q/∂λ) =  1/a^2 (- ∂ψ/∂λ ∂q/∂μ + ∂ψ/∂μ ∂q/∂λ)</p><p>The last term ∂ψ/∂λ accounts for the planetery vorticity, actually it is 2Ω ∂ψ/∂λ, but 2Ω == 1, (write q = q&#39; + 2Ωμ to proof it)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L65-L72">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.J3-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractMatrix{T}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.J3-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractMatrix{T}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.J3</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">J3(ψ::AbstractArray{T,2}, q::AbstractArray{T,2}, m::QG3Model{T})</code></pre><p>For the Jacobian at 850hPa, q = q&#39; + f(1+h/H<em>0) = q&#39; + f + f*h/H</em>0, so that the thrid term has to be added.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L95-L99">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.J_F-Union{Tuple{N}, Tuple{T}, Tuple{AbstractArray{T, N}, AbstractArray{T, N}, QG3.AbstractGridType{T}}} where {T, N}" href="#QG3.J_F-Union{Tuple{N}, Tuple{T}, Tuple{AbstractArray{T, N}, AbstractArray{T, N}, QG3.AbstractGridType{T}}} where {T, N}"><code>QG3.J_F</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">J_F(ψ::AbstractArray{T,N}, q::AbstractArray{T,N}, g::AbstractGridType{T})</code></pre><p>Compute the Jacobian determinant from ψ and q in μ,λ coordinates without the planetary vorticity, as used in computing the eddy/transient forcing</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L76-L80">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.J_F_Grid-Union{Tuple{N}, Tuple{T}, Tuple{AbstractArray{T, N}, AbstractArray{T, N}, QG3.AbstractGridType{T}}} where {T, N}" href="#QG3.J_F_Grid-Union{Tuple{N}, Tuple{T}, Tuple{AbstractArray{T, N}, AbstractArray{T, N}, QG3.AbstractGridType{T}}} where {T, N}"><code>QG3.J_F_Grid</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">J_F_Grid(ψ::AbstractArray{T,N}, q::AbstractArray{T,N}, g::AbstractGridType{T})</code></pre><p>Computes the Jacobian (without the planetary voriticity), input SPH, output Grid space </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L84-L88">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Jprime-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3.AbstractGridType{T}}} where T" href="#QG3.Jprime-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, AbstractArray{T, 3}, QG3.AbstractGridType{T}}} where T"><code>QG3.Jprime</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Jprime(ψ::AbstractArray{T,3}, q::AbstractArray{T,3}, g::AbstractGridType{T})</code></pre><p>Computes the Jacobian (∂ψ/∂μ ∂q/∂λ - ∂ψ/∂λ ∂q/∂μ). Directly computes the derivatives of the two inputs ψ and q and doesn&#39;t account for any additional contribution (e.g. from the Coriolis force).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L11-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3MM_adv-Tuple{Any, Any, Any}" href="#QG3.QG3MM_adv-Tuple{Any, Any, Any}"><code>QG3.QG3MM_adv</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3MM_adv(q, p, t)</code></pre><p>Just the Advection</p><p>dq = - J(ψ,q)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L158-L164">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3MM_base-Tuple{Any, Any, Any}" href="#QG3.QG3MM_base-Tuple{Any, Any, Any}"><code>QG3.QG3MM_base</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3MM_base(q, p, t)</code></pre><p>Base model used in the MM paper, with symmetrization around the equator</p><p>dq = - J(ψ,q) - D(ψ,q) + S</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L139-L145">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.QG3MM_gpu-Tuple{Any, Any, Any}" href="#QG3.QG3MM_gpu-Tuple{Any, Any, Any}"><code>QG3.QG3MM_gpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">QG3MM_gpu(q, p, t)</code></pre><p>Base model used in the MM paper dq = - J(ψ,q) - D(ψ,q) + S</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L44-L49">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SH_zero_mask" href="#QG3.SH_zero_mask"><code>QG3.SH_zero_mask</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SH_zero_mask(p::QG3.QG3ModelParameters, size_tup=nothing)</code></pre><p>Returns a mask that zeroes out all spurious elements of the SH coefficients + the (0,0) element which is also set zero</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L299-L303">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGrid_dθ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.SHtoGrid_dθ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.SHtoGrid_dθ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>derivative of input after θ (azimutal angle/colatitude) in SH, uses pre computed SH evaluations (dependend on the grid type)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L219-L221">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGrid_dλ-Tuple{Any, Any}" href="#QG3.SHtoGrid_dλ-Tuple{Any, Any}"><code>QG3.SHtoGrid_dλ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoGrid_dλ(ψ, m::QG3Model{T})
SHtoGrid_dλ(ψ, m::AbstractGridType{T})</code></pre><p>Derivative of input after φ (polar angle) or λ (longtitude) in SH to Grid</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L72-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGrid_dμ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.SHtoGrid_dμ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.SHtoGrid_dμ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoGrid_dμ(ψ, m::QG3Model{T}) 
SHtoGrid_dμ(ψ, g::AbstractGridType) 
SHtoGrid_dμ(ψ, d::GaussianGrid_dμ)</code></pre><p>Derivative of input after μ = sinϕ in SH, uses pre computed SH evaluations</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L197-L203">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGrid_dφ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.SHtoGrid_dφ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.SHtoGrid_dφ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoGrid_dφ(ψ, m::QG3Model{T})
SHtoGrid_dφ(ψ, m::AbstractGridType{T})
SHtoGrid_dφ(ψ, dλ::Derivative_dλ, sh2g::AbstractSHtoGridTransform)</code></pre><p>Derivative of input after φ (polar angle) or λ (longtitude) in SH to Grid</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L61-L67">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoGrid_dϕ-Tuple{Any, Any}" href="#QG3.SHtoGrid_dϕ-Tuple{Any, Any}"><code>QG3.SHtoGrid_dϕ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoGrid_dϕ(ψ, m)</code></pre><p>Derivative of input after ϕ - latitude in SH, uses pre computed SH evaluations</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L211-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoSH_dλ-Tuple{Any, Any}" href="#QG3.SHtoSH_dλ-Tuple{Any, Any}"><code>QG3.SHtoSH_dλ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoSH_dλ(ψ, m::QG3Model{T})
SHtoSH_dλ(ψ, g::GaussianGrid)</code></pre><p>Derivative of input after φ (polar angle/longtitude) in SH, output in SH</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L81-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.SHtoSH_dφ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.SHtoSH_dφ-Union{Tuple{T}, Tuple{Any, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.SHtoSH_dφ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SHtoSH_dφ(ψ, m::QG3Model{T})
SHtoSH_dφ(ψ, g::GaussianGrid) 
SHtoSH_dφ(ψ, g::Derivative_dλ)</code></pre><p>Derivative of input after φ (polar angle/longtitude) in SH, output in SH</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L89-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.TR-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.TR-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.TR</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TR(ψ::AbstractArray{T,3}, m::QG3Model{T})</code></pre><p>Computes the temperature relaxation of all levels</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_gpu.jl#L27-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.TR-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, Any, Any, T}} where T&lt;:Number" href="#QG3.TR-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, Any, Any, T}} where T&lt;:Number"><code>QG3.TR</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TR(m::QG3Model{T}, ψ1, ψ2, Ri::T)</code></pre><p>Computes the Temperature relaxation between layers with streamfunction <code>ψ1</code> and <code>ψ2</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L118-L122">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.change_msign!-Tuple{Any}" href="#QG3.change_msign!-Tuple{Any}"><code>QG3.change_msign!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">change_msign!(A)</code></pre><p>Change the sign of the m in SH (FastTranforms.jl convention of storing them). This version swaps the columns inplace</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L160-L164">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.change_msign-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractVector{Int64}}} where T" href="#QG3.change_msign-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractVector{Int64}}} where T"><code>QG3.change_msign</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">change_msign(A)</code></pre><p>Change the sign of the m in SH. This version returns a view</p><p>there is currently a bug or at least missing feature in Zygote, the AD library, that stops views from always working flawlessly when a view is mixed with prior indexing of an array. We need a view for the derivative after φ to change the sign of m, so here is a differentiable variant of the SHtoSH_dφ function for the 2d field</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L112-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_GaussWeights-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, Any}} where T&lt;:Number" href="#QG3.compute_GaussWeights-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, Any}} where T&lt;:Number"><code>QG3.compute_GaussWeights</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-computes gaussian weights for Legendre Transform, also checks if we really have the correct gaussian latitudes</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L383-L385">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_P-Union{Tuple{T}, Tuple{Integer, Integer, AbstractVector{T}}} where T&lt;:Number" href="#QG3.compute_P-Union{Tuple{T}, Tuple{Integer, Integer, AbstractVector{T}}} where T&lt;:Number"><code>QG3.compute_P</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute ass. Legendre Polynomials and dP/dx (derivative of ass. Legendre Polynomial) at the grid points and also the remainder of the Spherical Harmonics at the grid points using GSL</p><p>m values are stored 0,-1,1,-2,2,-3,3,... (on CPU) m values are stored 0,1,2,3,4,5,6,7, ...l_max, 0 (nothing),-1, -2, -3, (on GPU)  (the second 0 is the Imanigary part / sin part of the fourier transform which is always identical to zero, it is kept here to have equal matrix sizes)</p><p><strong>so far only |m| is used, as I assume real SPH.</strong></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L341-L351">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_S_Roads-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.compute_S_Roads-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.compute_S_Roads</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_S_Roads(data::AbstractArray{T,4}, m::QG3Model{T}; datasource=&quot;ψ&quot;)</code></pre><p>Pre-compute Forcing S data level,X,Y,t</p><p>Compute the forcing according to Roads, this is outlined in the MM and Corti paper as well.</p><p>This uses an unfiltered version, in the Corti paper there is a filter. Maybe implement it as well</p><ul><li>data, input data</li><li>m, QG3Model Parameters and pre-computed fields</li><li>kwargs<ul><li>datasource, either &#39;qprime&#39; (anomalous potential vorticity) or &#39;sf&#39; (streamfunction)</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/forcing.jl#L1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_S_t_corti" href="#QG3.compute_S_t_corti"><code>QG3.compute_S_t_corti</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute time-dependent Forcing S data level,X,Y,t</p><p>Like in the Corti paper for the seasonal run this interpolates between two extremal forcings.</p><ul><li>Nt_year: how many days does a year have / period length of the sinus</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/forcing.jl#L96-L102">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_TR-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_TR-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_TR</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute array of temperature relaxation coefficients.</p><p>(l=0, m=0)-coefficient is assigned zero. This results in this expansion coefficient beeing constant in the whole model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L219-L223">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_TR_matrix-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_TR_matrix-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_TR_matrix</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute matrices involved in the temperature relaxation in matrix form (for GPU / 3d fields)</p><p>TR = TR<em>Matrix * ψ  ∀ l ∈ [0,l</em>max]</p><p><strong>For l=0 the matrix is set to be zero</strong></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L98-L105">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_acosϕi-Tuple{QG3ModelParameters}" href="#QG3.compute_acosϕi-Tuple{QG3ModelParameters}"><code>QG3.compute_acosϕi</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute cos(ϕ)^-1 (latitude matrix)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L243-L245">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_batched_TR_matrix-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_batched_TR_matrix-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_batched_TR_matrix</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_batched_TR_matrix</code></pre><p>prepares the TR = TR<em>Matrix * ψ  ∀ l ∈ [0,l</em>max] matrix for batched multiply</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L125-L129">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_batched_ψq_transform_matrices-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.compute_batched_ψq_transform_matrices-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.compute_batched_ψq_transform_matrices</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_batched_ψq_transform_matrices</code></pre><p>prepares the transform from q to ψ and back for a batched matrix vector multiply, see also (@ref)[<code>compute_ψq_transform_matrices</code>]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L55-L59">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_coriolis_vector_grid-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_coriolis_vector_grid-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_coriolis_vector_grid</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute a matrix with with the Coriolis factor</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L164-L166">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_cosϕ-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T" href="#QG3.compute_cosϕ-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T"><code>QG3.compute_cosϕ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute cos(ϕ) (latitude) matrix</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L236-L238">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_f_J3-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, AbstractArray{T, 3}}} where T&lt;:Number" href="#QG3.compute_f_J3-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, AbstractArray{T, 3}}} where T&lt;:Number"><code>QG3.compute_f_J3</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute the additional contribution of the Coriolis force to the 850hPa Jacobian component in GPU ready format, for the Jacobian at 850hPa, q = q&#39; + f(1+h/H<em>0) = q&#39; + f + f*h/H</em>0, so that the thrid term has to be added.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L182-L184">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_k-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_k-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_k</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute drag coefficient k in real grid space, double check with values from paper</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L3-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_Δ-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_Δ-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_Δ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute the Laplacian in Spherical Harmonics, follows the matrix convention of FastTransforms.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L193-L195">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_Δ⁻¹-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number" href="#QG3.compute_Δ⁻¹-Union{Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}, Tuple{T}} where T&lt;:Number"><code>QG3.compute_Δ⁻¹</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute the inverse Laplacian in Spherical Harmonics, follows the matrix convention of FastTransforms.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L201-L203">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_ψq_transform_matrices-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T&lt;:Number" href="#QG3.compute_ψq_transform_matrices-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T&lt;:Number"><code>QG3.compute_ψq_transform_matrices</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Pre-compute matrices involved in transforming vorticity to streamfunction and back</p><p>q = Tψq * ψ + f ψ = Tqψ * (q - f) = Tψq^(-1) * (q - f)</p><p><strong>For l=0 the matrix is singular. In the fortran code they set q to something which for me does not make sense. Here Tψq(l=0) is just 1, so that transforming back and forth recovers the correct ψ. This makes sense in my eyes because q is only ever used for its spatial derivatives, all of which are 0 for l=0.</strong></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L20-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.compute_∇8-Tuple{QG3ModelParameters}" href="#QG3.compute_∇8-Tuple{QG3ModelParameters}"><code>QG3.compute_∇8</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>&quot; Pre-compute the 8-th derivative in Spherical Harmonics</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model_precomputations.jl#L211-L214">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.gpuoff-Tuple{}" href="#QG3.gpuoff-Tuple{}"><code>QG3.gpuoff</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gpuoff()</code></pre><p>Manually toggle GPU use off</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/QG3.jl#L26-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.gpuon-Tuple{}" href="#QG3.gpuon-Tuple{}"><code>QG3.gpuon</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gpuon()</code></pre><p>Manually toggle GPU use on (if available)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/QG3.jl#L17-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.grid-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, String}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, String, Int64}} where T&lt;:Number" href="#QG3.grid-Union{Tuple{T}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, String}, Tuple{QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}, String, Int64}} where T&lt;:Number"><code>QG3.grid</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">grid(p::QG3ModelParameters{T}, gridtype::String, N_level::Int=3; N_batch::Int=0, kwargs...)</code></pre><p>Convience constructor for the <a href="#QG3.AbstractGridType"><code>AbstractGridType</code></a> based on the parameters set in <code>p</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L142-L146">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.hours-Tuple{Any, QG3Model}" href="#QG3.hours-Tuple{Any, QG3Model}"><code>QG3.hours</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">hours(x, m::QG3Model)</code></pre><p>Convert from model time units to hours</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.isongpu-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T" href="#QG3.isongpu-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T"><code>QG3.isongpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">isongpu(m::QG3Model{T})</code></pre><p>Determines if the model was pre-computed to be used on GPU.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/basic_types.jl#L274-L278">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.kinetic_energy-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.kinetic_energy-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.kinetic_energy</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">kinetic_energy(ψ::AbstractArray{T,3}, m::QG3Model{T}) where T</code></pre><p>Computes the kinetic energy per layer</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L151-L155">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.lMatrix-Tuple{Integer, Integer}" href="#QG3.lMatrix-Tuple{Integer, Integer}"><code>QG3.lMatrix</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lMatrix(L, M; GPU=nothing)</code></pre><p>Return l-Matrix of SH coefficients in convention of FastTransforms.jl. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L172-L176">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.level_index-Tuple{Any, Any}" href="#QG3.level_index-Tuple{Any, Any}"><code>QG3.level_index</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">level_index(strings,lvls)</code></pre><p>Helper function for indexing netcdf files with many levels.</p><ul><li>string, array with name of levels to be selected</li><li>lvls, array with all levels</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L21-L29">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.load_precomputed_data-Tuple{}" href="#QG3.load_precomputed_data-Tuple{}"><code>QG3.load_precomputed_data</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">load_precomputed_data(GPU=false)</code></pre><p>Loads the precomputed data that is saved in the package. It is computed from ERA5 T21 u/v data. Returns in order</p><ul><li><code>S</code>, <code>qg3ppars</code>, <code>ψ_0</code>, <code>q_0</code></li><li>Forcing, Parameters, Streamfunction initial conditions, vorticity initial conditions</li></ul><p>If <code>GPU==true</code> returns those in GPU SPH order as <code>CuArrays</code>, otherwise uses CPU SPH order. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L84-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.mMatrix-Union{Tuple{T}, Tuple{T, T}} where T&lt;:Integer" href="#QG3.mMatrix-Union{Tuple{T}, Tuple{T, T}} where T&lt;:Integer"><code>QG3.mMatrix</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mMatrix(L::Integer, M::Integer)</code></pre><p>Pre-compute a matrix with (m) values of the SH matrix format of FastTransforms.jl, used for zonal derivative</p><p>Kwarg &#39;GPU&#39;, if given, overrides the automatic detection of wheather or not a GPU is avaible. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L190-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.make3d-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T&lt;:Number" href="#QG3.make3d-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T&lt;:Number"><code>QG3.make3d</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">make3d(A::AbstractArray{T,2})

repeats an array three times to turn it into (3 x size(A,1) x size(A,2)), for the fully matrix version of model.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L11-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.qprimetoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T" href="#QG3.qprimetoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T"><code>QG3.qprimetoψ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">qprimetoψ(p::QG3Model{T}, q::AbstractArray{T,3})</code></pre><p>Convert the anomalous potential vorticity q&#39; to streamfunction ψ. </p><p>This version is slightly slower than the old one (as it not aware of the matrix being half full of zeroes), but it is non-mutating which makes it suitable for the automatic differentation.</p><p>It replaces the double loop over the coefficient matrix with a batched vector multiply. The advantage of that is that it is optimised for GPU, so it might actually be faster on the GPU than doing a manual loop.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L40-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.qprimetoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 4}}} where T" href="#QG3.qprimetoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 4}}} where T"><code>QG3.qprimetoψ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">qprimetoψ(p::QG3Model{T}, q::AbstractArray{T,4})</code></pre><p>Convert the anomalous potential vorticity q&#39; to streamfunction ψ. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L51-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.qtoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T&lt;:Number" href="#QG3.qtoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T&lt;:Number"><code>QG3.qtoψ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">qtoψ(p::QG3Model{T}, q::AbstractArray{T,3})</code></pre><p>Convert the potential vorticity q to streamfunction ψ. See also <a href="#QG3.qprimetoψ-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T"><code>qprimetoψ</code></a>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L33-L37">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3ModelParameters}} where T" href="#QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractArray{T, 3}, QG3ModelParameters}} where T"><code>QG3.reorder_SH_cpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder_SH_cpu(A::AbstractArray{T,3},p::QG3ModelParameters)</code></pre><p>Reorders the SH coefficient so that computations on CPU are more efficient, inverse of <a href="#QG3.reorder_SH_gpu-Union{Tuple{T}, Tuple{S}, Tuple{AbstractMatrix{S}, QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}} where {S, T}"><code>reorder_SH_gpu</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L89-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3ModelParameters}} where T" href="#QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3ModelParameters}} where T"><code>QG3.reorder_SH_cpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder_SH_cpu(A::AbstractArray{T,4},p::QG3ModelParameters)</code></pre><p>Reorders the SH coefficient so that computations on CPU are more efficient, inverse of <a href="#QG3.reorder_SH_gpu-Union{Tuple{T}, Tuple{S}, Tuple{AbstractMatrix{S}, QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}} where {S, T}"><code>reorder_SH_gpu</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L109-L113">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3ModelParameters}} where T" href="#QG3.reorder_SH_cpu-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3ModelParameters}} where T"><code>QG3.reorder_SH_cpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder_SH_cpu(A::AbstractArray{T,2},p::QG3ModelParameters)</code></pre><p>Reorders the SH coefficient so that computations on CPU are more efficient, inverse of <a href="#QG3.reorder_SH_gpu-Union{Tuple{T}, Tuple{S}, Tuple{AbstractMatrix{S}, QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}} where {S, T}"><code>reorder_SH_gpu</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L70-L74">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.reorder_SH_gpu-Union{Tuple{T}, Tuple{S}, Tuple{AbstractMatrix{S}, QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}} where {S, T}" href="#QG3.reorder_SH_gpu-Union{Tuple{T}, Tuple{S}, Tuple{AbstractMatrix{S}, QG3ModelParameters{T, I, A, M} where {I&lt;:Int64, A&lt;:AbstractVector{T}, M&lt;:AbstractMatrix{T}}}} where {S, T}"><code>QG3.reorder_SH_gpu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Reorders the SH coefficient so that computations on GPU are more efficient, it also includes the truncation as the SH array has size N<em>lat x N</em>lon, however all entries outside of L x M are zeroes.</p><p>Original order (FastTransforms.jl) columns by m : 0, -1, 1, -2, -2, ....</p><p>New order columns by m: 0, 1, 2, ... l_max, 0 (nothing), -1, -2, ..</p><p>2d input assumes L x M matrix, (all fields in SH), also enlarges the matrix to include truncation (additional elements are zero) to N<em>lat x N</em>lons 3d input assumes N<em>lat (or 3) x L x M matrix (e.g. precomputed legendre polynomials), also enlarges the matrix to include truncation (additional elements are zero) to N</em>lat (or 3) x N<em>lats x N</em>lons</p><p>Incase CUDA is not used, it just return the input.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L9-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.sph_zero_spurious_modes!-Tuple{AbstractMatrix}" href="#QG3.sph_zero_spurious_modes!-Tuple{AbstractMatrix}"><code>QG3.sph_zero_spurious_modes!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Sets the unphysical numbers zero (usually only needed for FastTransforms.jl)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/sph_tools.jl#L230-L233">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.transform_SH" href="#QG3.transform_SH"><code>QG3.transform_SH</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transform_SH(data::AbstractArray{T,N}, t::GaussianGridtoSHTransform) 
transform_SH(data::AbstractArray, m::QG3Model)</code></pre><p>Transforms <code>data</code> into the spherical harmonics domain. The coefficents are ordered in a matrix in coloumns of the m value. On CPU the convention of FastTransform.jl is used (0, -1, 1, -2, 2, ...), on GPU the convention (0, 1, 2, 3, ...., (nothing, -1, -2, -3, ...)). Watch out, in future proabaly this might be standardized. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L18-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.transform_grid" href="#QG3.transform_grid"><code>QG3.transform_grid</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transform_grid(data::AbstractArray{T,N}, t::SHtoGaussianGridTransform)</code></pre><p>Transforms <code>data</code> from the spherical harmonics domain to a Gaussian Grid. The coefficents are ordered in a matrix in coloumns of the m value. On CPU the convention of FastTransform.jl is used (0, -1, 1, -2, 2, ...), on GPU the convention (0, 1, 2, 3, ...., (nothing, -1, -2, -3, ...)). Watch out, in future proabaly this might be standardized. </p><pre><code class="nohighlight hljs">transform_grid(data, m::QG3Model; varname=&quot;ψ&quot;)</code></pre><p>If varname ∈ [&quot;pv&quot;,&quot;q&quot;,&quot;vorticity&quot;] the [1,1] element is set to zero first, as this element is set to the streamfunction-[1,1] usually in the ψtoq routines.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/transforms.jl#L48-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.zeros_Grid-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T" href="#QG3.zeros_Grid-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T"><code>QG3.zeros_Grid</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zeros_Grid(p::QG3Model{T})</code></pre><p>Returns a zero array in the dimensions of the grid. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L131-L135">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.zeros_SH-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T" href="#QG3.zeros_SH-Union{Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}, Tuple{T}} where T"><code>QG3.zeros_SH</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zeros_SH(p::QG3Model{T})</code></pre><p>Returns a zero array in the dimensions of the SH. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/data_tools.jl#L110-L114">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Δ-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.Δ-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.Δ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Δ(ψ::AbstractArray, L::Laplacian{T})
Δ(ψ::AbstractArray, m::QG3Model{T})</code></pre><p>Apply the Laplacian. Also serves to convert regular vorticity (not the quasigeostrophic one) to streamfunction) </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L270-L275">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.Δ⁻¹-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.Δ⁻¹-Union{Tuple{T}, Tuple{AbstractArray{T, 4}, QG3.Laplacian{T, M, A1, A2} where {M&lt;:AbstractMatrix{T}, A1&lt;:AbstractArray{T, 3}, A2&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.Δ⁻¹</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Δ⁻¹(ψ::AbstractArray, m::QG3Model{T})</code></pre><p>Apply the inverse Laplacian. Also serves to convert the streamfunction to regular vorticity </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L283-L287">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.ψtoq-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T&lt;:Number" href="#QG3.ψtoq-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T&lt;:Number"><code>QG3.ψtoq</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ψtoq(p::QG3Model{T}, ψ::AbstractArray{T,3})</code></pre><p>Convert the streamfunction ψ to the potential vorticity. See also <a href="#QG3.ψtoqprime-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T"><code>ψtoqprime</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L26-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.ψtoqprime-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T" href="#QG3.ψtoqprime-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T"><code>QG3.ψtoqprime</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ψtoqprime(p::QG3Model{T}, ψ::AbstractArray{T,3})</code></pre><p>Convert the streamfunction ψ to (anomlous) potential vorticity q&#39; in spherical harmonics basis. See also <a href="#QG3.ψtoq-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 3}}} where T&lt;:Number"><code>ψtoq</code></a>.</p><p>This version is slightly slower than the old one on CPU (as it not aware of the matrix being half full of zeroes), but it is non-mutating which makes it suitable for the automatic differentation.</p><p>It replaces the double loop over the coefficient matrix with a batched vector multiply. The advantage other besides it being non-mutating is that it is optimised for GPU, so it might actually be faster on the GPU than doing a manual loop.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L15-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.ψtoqprime-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 4}}} where T" href="#QG3.ψtoqprime-Union{Tuple{T}, Tuple{QG3Model{T, P, G, M, A} where {P&lt;:QG3ModelParameters, G&lt;:QG3.AbstractGridType, M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}, AbstractArray{T, 4}}} where T"><code>QG3.ψtoqprime</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ψtoqprime(p::QG3Model{T}, ψ::AbstractArray{T,4})</code></pre><p>Convert the anomalous potential vorticity q&#39; to streamfunction ψ. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/model.jl#L58-L62">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="QG3.∇8-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3.Hyperdiffusion{T, M, A} where {M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T" href="#QG3.∇8-Union{Tuple{T}, Tuple{AbstractMatrix{T}, QG3.Hyperdiffusion{T, M, A} where {M&lt;:AbstractMatrix{T}, A&lt;:AbstractArray{T, 3}}}} where T"><code>QG3.∇8</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">∇8(q::AbstractArray{T,N}, H::Hyperdiffusion{T})</code></pre><p>Apply the hyperdiffusion to the input</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/maximilian-gelbrecht/QG3.jl/blob/0a2fe799265d3a069812eb189255941648b1c213/src/derivatives.jl#L323-L327">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 14 January 2025 15:04">Tuesday 14 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
